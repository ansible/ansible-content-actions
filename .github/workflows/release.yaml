---
name: Release collection
"on":
  workflow_call:
    inputs:
      ah_publish:
        description: Publish the collection on automation hub
        default: true
        type: boolean
      environment:
        description: The deployment environment
        required: true
        type: string
      galaxy_publish:
        default: true
        description: Publish the collection on galaxy
        type: boolean
    secrets:
      ah_token:
        required: false
      ah_client_id:
        required: false
      ah_client_secret:
        required: false
      ansible_galaxy_api_key:
        required: false
jobs:
  release_automation_hub:
    uses: ansible/ansible-content-actions/.github/workflows/release_ah.yaml@main
    with:
      environment: release
    secrets:
      ah_token: "${{ secrets.ah_token }}"
      ah_client_id: ${{ secrets.ah_client_id }}
      ah_client_secret: ${{ secrets.ah_client_secret }}
  release_galaxy:
    uses: ansible/ansible-content-actions/.github/workflows/release_galaxy.yaml@main
    needs:
      - release_automation_hub
    with:
      environment: release
    secrets:
      ansible_galaxy_api_key: "${{ secrets.ansible_galaxy_api_key }}"
